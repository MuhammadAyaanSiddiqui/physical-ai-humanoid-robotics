"use strict";(globalThis.webpackChunkphysical_ai_course=globalThis.webpackChunkphysical_ai_course||[]).push([[6912],{3683:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"module-2-simulation/ch5-gazebo/ros2-integration","title":"ROS 2 Integration: The ros_gz_bridge","description":"You have a simulation running in Gazebo and a set of ROS 2 nodes ready to control a robot. How do you connect them? The answer is the rosgzbridge, a powerful and essential tool for communication between the two systems.","source":"@site/docs/module-2-simulation/ch5-gazebo/ros2-integration.md","sourceDirName":"module-2-simulation/ch5-gazebo","slug":"/module-2-simulation/ch5-gazebo/ros2-integration","permalink":"/physical-ai-humanoid-robotics/docs/module-2-simulation/ch5-gazebo/ros2-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/module-2-simulation/ch5-gazebo/ros2-integration.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Attaching and Configuring Sensor Plugins in Gazebo","permalink":"/physical-ai-humanoid-robotics/docs/module-2-simulation/ch5-gazebo/sensor-plugins"},"next":{"title":"Getting Started with Unity and the Robotics Hub","permalink":"/physical-ai-humanoid-robotics/docs/module-2-simulation/ch6-unity/unity-robotics-hub"}}');var t=n(4848),r=n(8453);const o={},l="ROS 2 Integration: The ros_gz_bridge",d={},c=[{value:"How the Bridge Works",id:"how-the-bridge-works",level:2},{value:"Running the Bridge",id:"running-the-bridge",level:2},{value:"Method 1: Command Line",id:"method-1-command-line",level:3},{value:"Method 2: Launch File (Recommended)",id:"method-2-launch-file-recommended",level:3},{value:"Built-in Bridges in Sensor Plugins",id:"built-in-bridges-in-sensor-plugins",level:2},{value:"Common Topics to Bridge",id:"common-topics-to-bridge",level:2},{value:"Debugging the Bridge",id:"debugging-the-bridge",level:2}];function a(e){const s={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsxs)(s.h1,{id:"ros-2-integration-the-ros_gz_bridge",children:["ROS 2 Integration: The ",(0,t.jsx)(s.code,{children:"ros_gz_bridge"})]})}),"\n",(0,t.jsxs)(s.p,{children:["You have a simulation running in Gazebo and a set of ROS 2 nodes ready to control a robot. How do you connect them? The answer is the ",(0,t.jsx)(s.code,{children:"ros_gz_bridge"}),", a powerful and essential tool for communication between the two systems."]}),"\n",(0,t.jsx)(s.p,{children:"Gazebo and ROS 2 are separate frameworks with their own transport layers."}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Gazebo"})," uses its own publish-subscribe system, ",(0,t.jsx)(s.strong,{children:"Gazebo Transport"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"ROS 2"})," uses ",(0,t.jsx)(s.strong,{children:"DDS (Data Distribution Service)"})," as its middleware."]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"ros_gz_bridge"})," acts as a bi-directional translator, converting messages from one system to the other."]}),"\n",(0,t.jsx)(s.h2,{id:"how-the-bridge-works",children:"How the Bridge Works"}),"\n",(0,t.jsx)(s.p,{children:"The bridge is a standalone ROS 2 package that you run as a node. It allows you to specify which topics you want to bridge and in which direction."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-mermaid",children:'graph TD\n    subgraph "Gazebo Environment"\n        A[Gazebo Sensor Plugin<br>(e.g., Camera)]\n        B[Gazebo Topic<br>/camera]\n        A --\x3e|Publishes Gazebo Msg| B\n    end\n\n    subgraph "ROS 2 Environment"\n        D[ROS 2 Node<br>(e.g., Image Processor)]\n        E[ROS 2 Topic<br>/camera_ros]\n        D --\x3e|Subscribes to ROS 2 Msg| E\n    end\n\n    subgraph "ros_gz_bridge"\n        C[Bridge Node]\n    end\n\n    B --\x3e|Gazebo Msg| C\n    C --\x3e|Translates to ROS 2 Msg| E\n\n    style C fill:#ccf,stroke:#333,stroke-width:2px\n'})}),"\n",(0,t.jsx)(s.p,{children:"The bridge can translate messages in three ways:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Gazebo to ROS 2"}),": For sensor data. A camera plugin in Gazebo publishes an ",(0,t.jsx)(s.code,{children:"gz.msgs.Image"}),", and the bridge translates it to a ",(0,t.jsx)(s.code,{children:"sensor_msgs/msg/Image"})," for your ROS 2 nodes."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"ROS 2 to Gazebo"}),": For control commands. A ROS 2 node publishes a ",(0,t.jsx)(s.code,{children:"geometry_msgs/msg/Twist"}),", and the bridge translates it to an ",(0,t.jsx)(s.code,{children:"gz.msgs.Twist"})," to control a robot's velocity in Gazebo."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Bi-directional"}),": For state synchronization, like clock or TF messages."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"running-the-bridge",children:"Running the Bridge"}),"\n",(0,t.jsx)(s.p,{children:"There are two main ways to run the bridge: from the command line or from a launch file."}),"\n",(0,t.jsx)(s.h3,{id:"method-1-command-line",children:"Method 1: Command Line"}),"\n",(0,t.jsx)(s.p,{children:"You can run the bridge as an executable, providing the topics and message types as arguments. The syntax is:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"ros2 run ros_gz_bridge parameter_bridge <gazebo_topic>@<gazebo_msg_type>[<ros2_topic>@<ros2_msg_type>\n"})}),"\n",(0,t.jsx)(s.p,{children:"The direction is specified by the brackets:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"["}),": Gazebo to ROS 2 (subscribes to Gazebo, publishes to ROS 2)"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"]"}),": ROS 2 to Gazebo (subscribes to ROS 2, publishes to Gazebo)"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"@"}),": Separates the topic name from the message type."]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Example: Bridging a Camera (Gazebo to ROS 2)"})}),"\n",(0,t.jsxs)(s.p,{children:["If a Gazebo camera is publishing to the ",(0,t.jsx)(s.code,{children:"/camera"})," topic with message type ",(0,t.jsx)(s.code,{children:"gz.msgs.Image"}),", you can bridge it to a ROS 2 topic named ",(0,t.jsx)(s.code,{children:"/camera_ros"})," with message type ",(0,t.jsx)(s.code,{children:"sensor_msgs/msg/Image"}),"."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"ros2 run ros_gz_bridge parameter_bridge \\\n  /camera@gz.msgs.Image[sensor_msgs/msg/Image@/camera_ros\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Example: Bridging Velocity Commands (ROS 2 to Gazebo)"})}),"\n",(0,t.jsx)(s.p,{children:"To send velocity commands from ROS 2 to a Gazebo differential drive plugin:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"ros2 run ros_gz_bridge parameter_bridge \\\n  /cmd_vel@geometry_msgs/msg/Twist]gz.msgs.Twist@/model/my_robot/cmd_vel\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsxs)(s.em,{children:["Note: The Gazebo topic for model control is often namespaced under ",(0,t.jsx)(s.code,{children:"/model/<model_name>/"}),"."]})}),"\n",(0,t.jsx)(s.h3,{id:"method-2-launch-file-recommended",children:"Method 2: Launch File (Recommended)"}),"\n",(0,t.jsx)(s.p,{children:"For any real project, you'll want to include the bridge in your launch file. This ensures all communication channels are set up automatically when you start your simulation."}),"\n",(0,t.jsxs)(s.p,{children:["You can create a ",(0,t.jsx)(s.code,{children:"Node"})," that executes the ",(0,t.jsx)(s.code,{children:"parameter_bridge"}),"."]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Example: Launch file snippet for bridging camera and commands"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:"from launch_ros.actions import Node\n\n# ... inside your generate_launch_description function\n\nbridge_node = Node(\n    package='ros_gz_bridge',\n    executable='parameter_bridge',\n    arguments=[\n        # Bridge Camera Data (Gazebo -> ROS 2)\n        '/camera@gz.msgs.Image[sensor_msgs/msg/Image@/camera_ros',\n        \n        # Bridge Velocity Commands (ROS 2 -> Gazebo)\n        '/model/my_robot/cmd_vel@gz.msgs.Twist]geometry_msgs/msg/Twist@/cmd_vel'\n    ],\n    output='screen'\n)\n\n# Add bridge_node to your LaunchDescription\nreturn LaunchDescription([\n    # ... other nodes\n    bridge_node\n])\n"})}),"\n",(0,t.jsx)(s.h2,{id:"built-in-bridges-in-sensor-plugins",children:"Built-in Bridges in Sensor Plugins"}),"\n",(0,t.jsxs)(s.p,{children:["As we saw in the previous lesson, modern ",(0,t.jsx)(s.code,{children:"ros_gz"})," sensor plugins often handle bridging automatically. When you include the ",(0,t.jsx)(s.code,{children:"<ros>"})," block in your plugin definition, you are configuring a built-in bridge."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-xml",children:'<plugin name="camera_plugin" filename="libgz-sensors-camera.so">\n  <ros>\n    <namespace>my_camera</namespace>\n    <remapping>~/out:=image_raw</remapping>\n  </ros>\n</plugin>\n'})}),"\n",(0,t.jsxs)(s.p,{children:["This is effectively doing the work of the ",(0,t.jsx)(s.code,{children:"parameter_bridge"})," for you. The sensor plugin itself starts a bridge for its output topic."]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"When to use a standalone bridge vs. a built-in one?"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsxs)(s.strong,{children:["Use built-in bridges (",(0,t.jsx)(s.code,{children:"<ros>"})," tag)"]})," whenever possible. It's cleaner and couples the sensor directly with its ROS 2 interface. This is the standard for cameras, LiDAR, and IMUs."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsxs)(s.strong,{children:["Use a standalone ",(0,t.jsx)(s.code,{children:"parameter_bridge"})]})," when:","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"You need to bridge topics not associated with a specific sensor (e.g., clock, world state)."}),"\n",(0,t.jsx)(s.li,{children:"You need to send control commands from ROS 2 to a Gazebo plugin (like a differential drive or gripper controller)."}),"\n",(0,t.jsxs)(s.li,{children:["You are working with older plugins that don't have the ",(0,t.jsx)(s.code,{children:"<ros>"})," block integration."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"common-topics-to-bridge",children:"Common Topics to Bridge"}),"\n",(0,t.jsx)(s.p,{children:"Here is a list of common topics and their message types that you will frequently bridge:"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{style:{textAlign:"left"},children:"Purpose"}),(0,t.jsx)(s.th,{style:{textAlign:"left"},children:"Gazebo Topic"}),(0,t.jsx)(s.th,{style:{textAlign:"left"},children:"Gazebo Type"}),(0,t.jsx)(s.th,{style:{textAlign:"left"},children:"ROS 2 Type"}),(0,t.jsx)(s.th,{style:{textAlign:"left"},children:"Direction"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.strong,{children:"Clock"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"/clock"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"gz.msgs.Clock"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"rosgraph_msgs/msg/Clock"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"Gz -> ROS"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.strong,{children:"Transforms"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"/tf"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"gz.msgs.Pose_V"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"tf2_msgs/msg/TFMessage"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"Gz -> ROS"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.strong,{children:"Camera"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"/camera"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"gz.msgs.Image"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"sensor_msgs/msg/Image"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"Gz -> ROS"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.strong,{children:"LiDAR (3D)"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"/lidar"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"gz.msgs.PointCloudPacked"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"sensor_msgs/msg/PointCloud2"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"Gz -> ROS"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.strong,{children:"IMU"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"/imu"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"gz.msgs.IMU"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"sensor_msgs/msg/Imu"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"Gz -> ROS"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.strong,{children:"Velocity"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"/model/X/cmd_vel"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"gz.msgs.Twist"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"geometry_msgs/msg/Twist"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"ROS -> Gz"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.strong,{children:"Joint State"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"/world/X/model/Y/joint_state"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"gz.msgs.Model"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"sensor_msgs/msg/JointState"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"Gz -> ROS"})]})]})]}),"\n",(0,t.jsx)(s.h2,{id:"debugging-the-bridge",children:"Debugging the Bridge"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Check Topics"}),": Use ",(0,t.jsx)(s.code,{children:"gz topic -l"})," to see all available Gazebo topics and ",(0,t.jsx)(s.code,{children:"ros2 topic list"})," to see all ROS 2 topics. Confirm that the bridge is subscribing and publishing as expected."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Check Message Types"}),": Make sure you are using compatible message types. The ",(0,t.jsx)(s.code,{children:"ros_gz"})," documentation provides a table of all supported message pairings."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Use Verbose Output"}),": Run the bridge with ",(0,t.jsx)(s.code,{children:"-v"})," to get more detailed logging about which topics are being bridged and whether the mappings are successful."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Isolate the Problem"}),": Test each side independently. Can you ",(0,t.jsx)(s.code,{children:"gz topic -e -t /camera"})," to see data in Gazebo? Can you ",(0,t.jsx)(s.code,{children:"ros2 topic pub"})," to your command topic? This will tell you if the problem is with the bridge or with the publisher/subscriber."]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["By mastering the ",(0,t.jsx)(s.code,{children:"ros_gz_bridge"}),", you unlock the full power of ROS 2 for controlling and sensing in a high-fidelity Gazebo simulation."]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>l});var i=n(6540);const t={},r=i.createContext(t);function o(e){const s=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:s},e.children)}}}]);