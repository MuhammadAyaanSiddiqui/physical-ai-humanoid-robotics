"use strict";(globalThis.webpackChunkphysical_ai_course=globalThis.webpackChunkphysical_ai_course||[]).push([[856],{8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>t});var i=s(6540);const r={},l=i.createContext(r);function c(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(l.Provider,{value:n},e.children)}},8755:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"module-1-ros2/ch1-fundamentals/services-actions","title":"Services and Actions","description":"Overview","source":"@site/docs/module-1-ros2/ch1-fundamentals/services-actions.md","sourceDirName":"module-1-ros2/ch1-fundamentals","slug":"/module-1-ros2/ch1-fundamentals/services-actions","permalink":"/physical-ai-humanoid-robotics/docs/module-1-ros2/ch1-fundamentals/services-actions","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/module-1-ros2/ch1-fundamentals/services-actions.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Nodes and Topics","permalink":"/physical-ai-humanoid-robotics/docs/module-1-ros2/ch1-fundamentals/nodes-topics"},"next":{"title":"ROS 2 CLI Tools","permalink":"/physical-ai-humanoid-robotics/docs/module-1-ros2/ch1-fundamentals/cli-tools"}}');var r=s(4848),l=s(8453);const c={sidebar_position:3},t="Services and Actions",o={},a=[{value:"Overview",id:"overview",level:2},{value:"Communication Patterns Compared",id:"communication-patterns-compared",level:2},{value:"ROS 2 Services",id:"ros-2-services",level:2},{value:"What is a Service?",id:"what-is-a-service",level:3},{value:"When to Use Services",id:"when-to-use-services",level:3},{value:"Service Definition Files (.srv)",id:"service-definition-files-srv",level:3},{value:"Built-in Service Types",id:"built-in-service-types",level:3},{value:"Creating a Service Server",id:"creating-a-service-server",level:2},{value:"Code Breakdown",id:"code-breakdown",level:3},{value:"Creating a Service Client",id:"creating-a-service-client",level:2},{value:"Code Breakdown",id:"code-breakdown-1",level:3},{value:"Service CLI Tools",id:"service-cli-tools",level:2},{value:"List Available Services",id:"list-available-services",level:3},{value:"Get Service Type",id:"get-service-type",level:3},{value:"Call Service from CLI",id:"call-service-from-cli",level:3},{value:"Find Services by Type",id:"find-services-by-type",level:3},{value:"ROS 2 Actions",id:"ros-2-actions",level:2},{value:"What is an Action?",id:"what-is-an-action",level:3},{value:"When to Use Actions",id:"when-to-use-actions",level:3},{value:"Action Definition Files (.action)",id:"action-definition-files-action",level:3},{value:"Built-in Action Types",id:"built-in-action-types",level:3},{value:"Creating an Action Server",id:"creating-an-action-server",level:2},{value:"Code Breakdown",id:"code-breakdown-2",level:3},{value:"Creating an Action Client",id:"creating-an-action-client",level:2},{value:"Code Breakdown",id:"code-breakdown-3",level:3},{value:"Action CLI Tools",id:"action-cli-tools",level:2},{value:"List Available Actions",id:"list-available-actions",level:3},{value:"Get Action Info",id:"get-action-info",level:3},{value:"Send Action Goal from CLI",id:"send-action-goal-from-cli",level:3},{value:"Send Goal with Feedback Display",id:"send-goal-with-feedback-display",level:3},{value:"Choosing the Right Pattern",id:"choosing-the-right-pattern",level:2},{value:"Pattern Comparison",id:"pattern-comparison",level:3},{value:"Hands-On Exercises",id:"hands-on-exercises",level:2},{value:"Exercise 1: Battery Service",id:"exercise-1-battery-service",level:3},{value:"Exercise 2: Countdown Action",id:"exercise-2-countdown-action",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Services",id:"services",level:3},{value:"Actions",id:"actions",level:3},{value:"Common Pitfalls",id:"common-pitfalls",level:2},{value:"Pitfall 1: Blocking Service Callbacks",id:"pitfall-1-blocking-service-callbacks",level:3},{value:"Pitfall 2: Not Checking Service Availability",id:"pitfall-2-not-checking-service-availability",level:3},{value:"Pitfall 3: Forgetting Feedback",id:"pitfall-3-forgetting-feedback",level:3},{value:"Pitfall 4: Not Handling Cancellation",id:"pitfall-4-not-handling-cancellation",level:3},{value:"Next Steps",id:"next-steps",level:2},{value:"Resources",id:"resources",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"services-and-actions",children:"Services and Actions"})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:["While topics provide one-way, streaming communication, ",(0,r.jsx)(n.strong,{children:"services"})," and ",(0,r.jsx)(n.strong,{children:"actions"})," enable request-response interactions between nodes. This lesson covers when and how to use each pattern for different robotic tasks."]}),"\n",(0,r.jsx)(n.h2,{id:"communication-patterns-compared",children:"Communication Patterns Compared"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Pattern"}),(0,r.jsx)(n.th,{children:"Direction"}),(0,r.jsx)(n.th,{children:"Use Case"}),(0,r.jsx)(n.th,{children:"Example"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Topic"})}),(0,r.jsx)(n.td,{children:"One-way, continuous"}),(0,r.jsx)(n.td,{children:"Sensor streaming"}),(0,r.jsx)(n.td,{children:"Camera publishing images"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Service"})}),(0,r.jsx)(n.td,{children:"Request-response, synchronous"}),(0,r.jsx)(n.td,{children:"One-time queries"}),(0,r.jsx)(n.td,{children:'"Get robot pose"'})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Action"})}),(0,r.jsx)(n.td,{children:"Request-response, asynchronous"}),(0,r.jsx)(n.td,{children:"Long-running tasks"}),(0,r.jsx)(n.td,{children:'"Navigate to goal"'})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"ros-2-services",children:"ROS 2 Services"}),"\n",(0,r.jsx)(n.h3,{id:"what-is-a-service",children:"What is a Service?"}),"\n",(0,r.jsxs)(n.p,{children:["A ",(0,r.jsx)(n.strong,{children:"service"})," is a synchronous, request-response communication pattern. The client sends a request and ",(0,r.jsx)(n.strong,{children:"blocks"})," until the server responds."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Client   \u2502\u2500\u2500\u2500\u2500\u2500 Request \u2500\u2500\u2500\u2500\u2500\u25ba\u2502   Server   \u2502\n\u2502            \u2502                    \u2502            \u2502\n\u2502  (Blocks)  \u2502\u25c4\u2500\u2500\u2500\u2500 Response \u2500\u2500\u2500\u2500\u2502 (Computes) \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(n.h3,{id:"when-to-use-services",children:"When to Use Services"}),"\n",(0,r.jsx)(n.p,{children:"Services are ideal for:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Configuration queries"}),": Get/set parameters"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"State queries"}),': "What\'s the battery level?"']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Quick computations"}),': "Calculate inverse kinematics"']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Mode switches"}),': "Enable/disable motor"']}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"service-definition-files-srv",children:"Service Definition Files (.srv)"}),"\n",(0,r.jsxs)(n.p,{children:["Services are defined with ",(0,r.jsx)(n.code,{children:".srv"})," files:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-srv",children:"# Request\nint64 a\nint64 b\n---\n# Response\nint64 sum\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"---"})," separator divides request and response fields."]}),"\n",(0,r.jsx)(n.h3,{id:"built-in-service-types",children:"Built-in Service Types"}),"\n",(0,r.jsxs)(n.p,{children:["Common service types from ",(0,r.jsx)(n.code,{children:"std_srvs"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"std_srvs/Empty           # No request or response data\nstd_srvs/SetBool         # Enable/disable something\nstd_srvs/Trigger         # Trigger an action, get success/message\n"})}),"\n",(0,r.jsxs)(n.p,{children:["From ",(0,r.jsx)(n.code,{children:"example_interfaces"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"example_interfaces/AddTwoInts    # Add two integers\nexample_interfaces/SetBool       # Set boolean value\n"})}),"\n",(0,r.jsx)(n.h2,{id:"creating-a-service-server",children:"Creating a Service Server"}),"\n",(0,r.jsx)(n.p,{children:"Here's a simple service server that adds two integers:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\nclass AddTwoIntsServer(Node):\n    def __init__(self):\n        super().__init__('add_two_ints_server')\n        self.srv = self.create_service(\n            AddTwoInts,\n            'add_two_ints',\n            self.add_two_ints_callback\n        )\n        self.get_logger().info('Add Two Ints Server ready')\n\n    def add_two_ints_callback(self, request, response):\n        response.sum = request.a + request.b\n        self.get_logger().info(f'Incoming request: {request.a} + {request.b}')\n        return response\n\ndef main(args=None):\n    rclpy.init(args=args)\n    server = AddTwoIntsServer()\n    rclpy.spin(server)\n    server.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"code-breakdown",children:"Code Breakdown"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Create Service"}),": ",(0,r.jsx)(n.code,{children:"create_service(ServiceType, 'service_name', callback)"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Define Callback"}),": Function receives ",(0,r.jsx)(n.code,{children:"request"})," and ",(0,r.jsx)(n.code,{children:"response"})," objects"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Populate Response"}),": Set response fields based on request"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Return Response"}),": Return the response object"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"creating-a-service-client",children:"Creating a Service Client"}),"\n",(0,r.jsx)(n.p,{children:"Here's a service client that calls the addition service:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import sys\nimport rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\nclass AddTwoIntsClient(Node):\n    def __init__(self):\n        super().__init__('add_two_ints_client')\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\n\n        # Wait for service to become available\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Service not available, waiting...')\n\n        self.req = AddTwoInts.Request()\n\n    def send_request(self, a, b):\n        self.req.a = a\n        self.req.b = b\n        self.future = self.cli.call_async(self.req)\n        rclpy.spin_until_future_complete(self, self.future)\n        return self.future.result()\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    if len(sys.argv) != 3:\n        print('Usage: add_two_ints_client <a> <b>')\n        return\n\n    client = AddTwoIntsClient()\n    response = client.send_request(int(sys.argv[1]), int(sys.argv[2]))\n\n    client.get_logger().info(f'Result: {sys.argv[1]} + {sys.argv[2]} = {response.sum}')\n\n    client.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"code-breakdown-1",children:"Code Breakdown"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Create Client"}),": ",(0,r.jsx)(n.code,{children:"create_client(ServiceType, 'service_name')"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Wait for Service"}),": ",(0,r.jsx)(n.code,{children:"wait_for_service()"})," blocks until server is ready"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Create Request"}),": Populate request fields"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Call Service"}),": ",(0,r.jsx)(n.code,{children:"call_async()"})," sends request and returns a future"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Wait for Response"}),": ",(0,r.jsx)(n.code,{children:"spin_until_future_complete()"})," blocks until response arrives"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"service-cli-tools",children:"Service CLI Tools"}),"\n",(0,r.jsx)(n.h3,{id:"list-available-services",children:"List Available Services"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 service list\n"})}),"\n",(0,r.jsx)(n.p,{children:"Output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"/add_two_ints\n/parameter_events\n/describe_parameters\n/get_parameters\n"})}),"\n",(0,r.jsx)(n.h3,{id:"get-service-type",children:"Get Service Type"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 service type /add_two_ints\n"})}),"\n",(0,r.jsx)(n.p,{children:"Output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"example_interfaces/srv/AddTwoInts\n"})}),"\n",(0,r.jsx)(n.h3,{id:"call-service-from-cli",children:"Call Service from CLI"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'ros2 service call /add_two_ints example_interfaces/srv/AddTwoInts "{a: 5, b: 3}"\n'})}),"\n",(0,r.jsx)(n.p,{children:"Output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"requester: making request: example_interfaces.srv.AddTwoInts_Request(a=5, b=3)\n\nresponse:\nexample_interfaces.srv.AddTwoInts_Response(sum=8)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"find-services-by-type",children:"Find Services by Type"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 service find example_interfaces/srv/AddTwoInts\n"})}),"\n",(0,r.jsx)(n.p,{children:"Output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"/add_two_ints\n"})}),"\n",(0,r.jsx)(n.h2,{id:"ros-2-actions",children:"ROS 2 Actions"}),"\n",(0,r.jsx)(n.h3,{id:"what-is-an-action",children:"What is an Action?"}),"\n",(0,r.jsxs)(n.p,{children:["An ",(0,r.jsx)(n.strong,{children:"action"})," is an asynchronous, long-running task with ",(0,r.jsx)(n.strong,{children:"feedback"}),". Unlike services, actions don't block the client and provide progress updates."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Client   \u2502\u2500\u2500\u2500\u2500\u2500 Goal \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502   Server   \u2502\n\u2502            \u2502                    \u2502            \u2502\n\u2502  (Async)   \u2502\u25c4\u2500 Feedback (5%) \u2500\u2500\u2502  (Working) \u2502\n\u2502            \u2502\u25c4\u2500 Feedback (50%)\u2500\u2500\u2502            \u2502\n\u2502            \u2502\u25c4\u2500 Feedback (95%)\u2500\u2500\u2502            \u2502\n\u2502            \u2502\u25c4\u2500\u2500\u2500\u2500 Result \u2500\u2500\u2500\u2500\u2500\u2500\u2502  (Done)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(n.h3,{id:"when-to-use-actions",children:"When to Use Actions"}),"\n",(0,r.jsx)(n.p,{children:"Actions are ideal for:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Navigation"}),": Move robot to goal position"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Manipulation"}),": Pick and place object"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Long computations"}),": Train ML model, process large dataset"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Any task with progress"}),": Task that takes >1 second"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"action-definition-files-action",children:"Action Definition Files (.action)"}),"\n",(0,r.jsxs)(n.p,{children:["Actions are defined with ",(0,r.jsx)(n.code,{children:".action"})," files:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-action",children:"# Goal\nfloat64 target_x\nfloat64 target_y\n---\n# Result\nfloat64 final_x\nfloat64 final_y\nbool success\n---\n# Feedback\nfloat64 current_x\nfloat64 current_y\nfloat64 distance_remaining\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Three sections separated by ",(0,r.jsx)(n.code,{children:"---"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Goal"}),": What client wants"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Result"}),": Final outcome"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Feedback"}),": Progress updates"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"built-in-action-types",children:"Built-in Action Types"}),"\n",(0,r.jsxs)(n.p,{children:["Common action from ",(0,r.jsx)(n.code,{children:"example_interfaces"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"example_interfaces/Fibonacci     # Calculate Fibonacci sequence\n"})}),"\n",(0,r.jsxs)(n.p,{children:["From ",(0,r.jsx)(n.code,{children:"nav2_msgs"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"nav2_msgs/NavigateToPose        # Navigate robot to goal pose\nnav2_msgs/FollowWaypoints       # Follow sequence of waypoints\n"})}),"\n",(0,r.jsx)(n.h2,{id:"creating-an-action-server",children:"Creating an Action Server"}),"\n",(0,r.jsx)(n.p,{children:"Here's an action server that calculates Fibonacci sequence with feedback:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import time\nimport rclpy\nfrom rclpy.action import ActionServer\nfrom rclpy.node import Node\nfrom example_interfaces.action import Fibonacci\n\nclass FibonacciActionServer(Node):\n    def __init__(self):\n        super().__init__('fibonacci_action_server')\n        self._action_server = ActionServer(\n            self,\n            Fibonacci,\n            'fibonacci',\n            self.execute_callback\n        )\n        self.get_logger().info('Fibonacci Action Server ready')\n\n    def execute_callback(self, goal_handle):\n        self.get_logger().info('Executing goal...')\n\n        # Initialize feedback\n        feedback_msg = Fibonacci.Feedback()\n        feedback_msg.sequence = [0, 1]\n\n        # Calculate Fibonacci sequence\n        for i in range(1, goal_handle.request.order):\n            if goal_handle.is_cancel_requested:\n                goal_handle.canceled()\n                self.get_logger().info('Goal canceled')\n                return Fibonacci.Result()\n\n            feedback_msg.sequence.append(\n                feedback_msg.sequence[i] + feedback_msg.sequence[i-1]\n            )\n\n            # Publish feedback\n            goal_handle.publish_feedback(feedback_msg)\n            self.get_logger().info(f'Feedback: {feedback_msg.sequence}')\n\n            time.sleep(0.5)  # Simulate work\n\n        # Send result\n        goal_handle.succeed()\n        result = Fibonacci.Result()\n        result.sequence = feedback_msg.sequence\n        self.get_logger().info(f'Goal succeeded! Result: {result.sequence}')\n        return result\n\ndef main(args=None):\n    rclpy.init(args=args)\n    server = FibonacciActionServer()\n    rclpy.spin(server)\n    server.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"code-breakdown-2",children:"Code Breakdown"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Create Action Server"}),": ",(0,r.jsx)(n.code,{children:"ActionServer(node, ActionType, 'action_name', callback)"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Execute Callback"}),": Long-running function that processes goal"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Publish Feedback"}),": ",(0,r.jsx)(n.code,{children:"goal_handle.publish_feedback()"})," sends progress updates"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Check for Cancel"}),": ",(0,r.jsx)(n.code,{children:"goal_handle.is_cancel_requested"})," handles cancellation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Send Result"}),": ",(0,r.jsx)(n.code,{children:"goal_handle.succeed()"})," marks completion and returns result"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"creating-an-action-client",children:"Creating an Action Client"}),"\n",(0,r.jsx)(n.p,{children:"Here's an action client that sends a goal and monitors feedback:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.action import ActionClient\nfrom rclpy.node import Node\nfrom example_interfaces.action import Fibonacci\n\nclass FibonacciActionClient(Node):\n    def __init__(self):\n        super().__init__('fibonacci_action_client')\n        self._action_client = ActionClient(self, Fibonacci, 'fibonacci')\n\n    def send_goal(self, order):\n        goal_msg = Fibonacci.Goal()\n        goal_msg.order = order\n\n        self.get_logger().info('Waiting for action server...')\n        self._action_client.wait_for_server()\n\n        self.get_logger().info(f'Sending goal: order={order}')\n\n        self._send_goal_future = self._action_client.send_goal_async(\n            goal_msg,\n            feedback_callback=self.feedback_callback\n        )\n\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\n\n    def goal_response_callback(self, future):\n        goal_handle = future.result()\n        if not goal_handle.accepted:\n            self.get_logger().info('Goal rejected')\n            return\n\n        self.get_logger().info('Goal accepted')\n\n        self._get_result_future = goal_handle.get_result_async()\n        self._get_result_future.add_done_callback(self.get_result_callback)\n\n    def get_result_callback(self, future):\n        result = future.result().result\n        self.get_logger().info(f'Result: {result.sequence}')\n        rclpy.shutdown()\n\n    def feedback_callback(self, feedback_msg):\n        feedback = feedback_msg.feedback\n        self.get_logger().info(f'Feedback: {feedback.sequence}')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    client = FibonacciActionClient()\n    client.send_goal(10)\n    rclpy.spin(client)\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"code-breakdown-3",children:"Code Breakdown"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Create Action Client"}),": ",(0,r.jsx)(n.code,{children:"ActionClient(node, ActionType, 'action_name')"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Send Goal"}),": ",(0,r.jsx)(n.code,{children:"send_goal_async()"})," with feedback callback"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Goal Response"}),": Callback handles goal acceptance/rejection"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Feedback Callback"}),": Receives progress updates during execution"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Result Callback"}),": Receives final result when action completes"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"action-cli-tools",children:"Action CLI Tools"}),"\n",(0,r.jsx)(n.h3,{id:"list-available-actions",children:"List Available Actions"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 action list\n"})}),"\n",(0,r.jsx)(n.p,{children:"Output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"/fibonacci\n/turtle1/rotate_absolute\n"})}),"\n",(0,r.jsx)(n.h3,{id:"get-action-info",children:"Get Action Info"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 action info /fibonacci\n"})}),"\n",(0,r.jsx)(n.p,{children:"Output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Action: /fibonacci\nAction clients: 1\n    /fibonacci_action_client\nAction servers: 1\n    /fibonacci_action_server\n"})}),"\n",(0,r.jsx)(n.h3,{id:"send-action-goal-from-cli",children:"Send Action Goal from CLI"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'ros2 action send_goal /fibonacci example_interfaces/action/Fibonacci "{order: 5}"\n'})}),"\n",(0,r.jsx)(n.p,{children:"Output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Waiting for action server...\nSending goal...\nGoal accepted\nFeedback: {sequence: [0, 1, 1]}\nFeedback: {sequence: [0, 1, 1, 2]}\nFeedback: {sequence: [0, 1, 1, 2, 3]}\nResult: {sequence: [0, 1, 1, 2, 3, 5]}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"send-goal-with-feedback-display",children:"Send Goal with Feedback Display"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'ros2 action send_goal --feedback /fibonacci example_interfaces/action/Fibonacci "{order: 10}"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"choosing-the-right-pattern",children:"Choosing the Right Pattern"}),"\n",(0,r.jsx)(n.p,{children:"Use this decision tree to choose the appropriate communication pattern:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Is the data continuous/streaming?\n\u251c\u2500 YES \u2192 Use TOPIC\n\u2514\u2500 NO \u2192 Is it a request-response?\n    \u251c\u2500 YES \u2192 Does it take >1 second?\n    \u2502   \u251c\u2500 YES \u2192 Use ACTION\n    \u2502   \u2514\u2500 NO \u2192 Use SERVICE\n    \u2514\u2500 NO \u2192 Use TOPIC\n"})}),"\n",(0,r.jsx)(n.h3,{id:"pattern-comparison",children:"Pattern Comparison"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Aspect"}),(0,r.jsx)(n.th,{children:"Topic"}),(0,r.jsx)(n.th,{children:"Service"}),(0,r.jsx)(n.th,{children:"Action"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Direction"})}),(0,r.jsx)(n.td,{children:"One-way"}),(0,r.jsx)(n.td,{children:"Two-way"}),(0,r.jsx)(n.td,{children:"Two-way"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Timing"})}),(0,r.jsx)(n.td,{children:"Continuous"}),(0,r.jsx)(n.td,{children:"Synchronous"}),(0,r.jsx)(n.td,{children:"Asynchronous"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Feedback"})}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"Yes"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Cancellable"})}),(0,r.jsx)(n.td,{children:"N/A"}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"Yes"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Blocking"})}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"Yes"}),(0,r.jsx)(n.td,{children:"No"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"hands-on-exercises",children:"Hands-On Exercises"}),"\n",(0,r.jsx)(n.h3,{id:"exercise-1-battery-service",children:"Exercise 1: Battery Service"}),"\n",(0,r.jsx)(n.p,{children:"Create a service that returns simulated battery level."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Requirements:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Service name: ",(0,r.jsx)(n.code,{children:"/robot/battery_level"})]}),"\n",(0,r.jsxs)(n.li,{children:["Service type: ",(0,r.jsx)(n.code,{children:"example_interfaces/srv/Trigger"})]}),"\n",(0,r.jsx)(n.li,{children:'Response: Success=true, message="Battery: XX%"'}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Solution"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import Trigger\nimport random\n\nclass BatteryService(Node):\n    def __init__(self):\n        super().__init__('battery_service')\n        self.srv = self.create_service(\n            Trigger,\n            '/robot/battery_level',\n            self.battery_callback\n        )\n        self.get_logger().info('Battery service ready')\n\n    def battery_callback(self, request, response):\n        level = random.randint(0, 100)\n        response.success = True\n        response.message = f'Battery: {level}%'\n        self.get_logger().info(f'Battery query: {level}%')\n        return response\n\ndef main(args=None):\n    rclpy.init(args=args)\n    service = BatteryService()\n    rclpy.spin(service)\n    service.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),(0,r.jsx)(n.p,{children:"Test with:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 service call /robot/battery_level example_interfaces/srv/Trigger\n"})})]}),"\n",(0,r.jsx)(n.h3,{id:"exercise-2-countdown-action",children:"Exercise 2: Countdown Action"}),"\n",(0,r.jsx)(n.p,{children:"Create an action that counts down from a target number to zero with feedback."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Requirements:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Action name: ",(0,r.jsx)(n.code,{children:"/countdown"})]}),"\n",(0,r.jsx)(n.li,{children:"Goal: Integer target value"}),"\n",(0,r.jsx)(n.li,{children:"Feedback: Current count every second"}),"\n",(0,r.jsx)(n.li,{children:"Result: Success message"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Solution"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import time\nimport rclpy\nfrom rclpy.action import ActionServer\nfrom rclpy.node import Node\nfrom example_interfaces.action import Fibonacci  # Reuse for simplicity\n\nclass CountdownActionServer(Node):\n    def __init__(self):\n        super().__init__('countdown_action_server')\n        self._action_server = ActionServer(\n            self,\n            Fibonacci,\n            'countdown',\n            self.execute_callback\n        )\n        self.get_logger().info('Countdown Action Server ready')\n\n    def execute_callback(self, goal_handle):\n        self.get_logger().info(f'Starting countdown from {goal_handle.request.order}')\n\n        feedback_msg = Fibonacci.Feedback()\n\n        for i in range(goal_handle.request.order, -1, -1):\n            if goal_handle.is_cancel_requested:\n                goal_handle.canceled()\n                return Fibonacci.Result()\n\n            feedback_msg.sequence = [i]\n            goal_handle.publish_feedback(feedback_msg)\n            self.get_logger().info(f'Count: {i}')\n            time.sleep(1.0)\n\n        goal_handle.succeed()\n        result = Fibonacci.Result()\n        result.sequence = [0]\n        self.get_logger().info('Countdown complete!')\n        return result\n\ndef main(args=None):\n    rclpy.init(args=args)\n    server = CountdownActionServer()\n    rclpy.spin(server)\n    server.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),(0,r.jsx)(n.p,{children:"Test with:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'ros2 action send_goal --feedback /countdown example_interfaces/action/Fibonacci "{order: 10}"\n'})})]}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsx)(n.h3,{id:"services",children:"Services"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Keep services fast"}),": Services block clients, so compute quickly (<100ms)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use for queries"}),": Services are perfect for state queries"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Handle errors"}),": Return success/failure in response"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Wait for service"}),": Always check if service is available before calling"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"actions",children:"Actions"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Provide frequent feedback"}),": Update clients every 0.5-2 seconds"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Handle cancellation"}),": Check ",(0,r.jsx)(n.code,{children:"is_cancel_requested"})," regularly"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Set goals"}),": Use for tasks taking >1 second"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Report progress"}),": Include meaningful progress information in feedback"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"common-pitfalls",children:"Common Pitfalls"}),"\n",(0,r.jsx)(n.h3,{id:"pitfall-1-blocking-service-callbacks",children:"Pitfall 1: Blocking Service Callbacks"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Service callback takes too long, blocks the executor"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Keep callbacks under 100ms, use actions for long tasks"]}),"\n",(0,r.jsx)(n.h3,{id:"pitfall-2-not-checking-service-availability",children:"Pitfall 2: Not Checking Service Availability"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Client calls service before server is ready, hangs forever"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Use ",(0,r.jsx)(n.code,{children:"wait_for_service()"})," with timeout"]}),"\n",(0,r.jsx)(n.h3,{id:"pitfall-3-forgetting-feedback",children:"Pitfall 3: Forgetting Feedback"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Action runs but never sends feedback, client has no progress info"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Call ",(0,r.jsx)(n.code,{children:"publish_feedback()"})," regularly during execution"]}),"\n",(0,r.jsx)(n.h3,{id:"pitfall-4-not-handling-cancellation",children:"Pitfall 4: Not Handling Cancellation"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Action ignores cancel requests, wastes resources"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Check ",(0,r.jsx)(n.code,{children:"is_cancel_requested"})," in action loop"]}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsx)(n.p,{children:"Now that you understand services and actions:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Learn about ",(0,r.jsx)(n.a,{href:"/physical-ai-humanoid-robotics/docs/module-1-ros2/ch1-fundamentals/cli-tools",children:"CLI Tools"})," for debugging and introspection"]}),"\n",(0,r.jsxs)(n.li,{children:["Build your ",(0,r.jsx)(n.a,{href:"/physical-ai-humanoid-robotics/docs/module-1-ros2/ch2-python-rclpy/first-node",children:"First Python Node"})," from scratch"]}),"\n",(0,r.jsxs)(n.li,{children:["Explore ",(0,r.jsx)(n.a,{href:"/physical-ai-humanoid-robotics/docs/module-1-ros2/ch2-python-rclpy/message-types",children:"Message Types"})," for custom messages"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Concepts/Basic/About-Services.html",children:"ROS 2 Services"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Concepts/Basic/About-Actions.html",children:"ROS 2 Actions"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Services/Understanding-ROS2-Services.html",children:"Understanding Services"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Actions/Understanding-ROS2-Actions.html",children:"Understanding Actions"})}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Prerequisites"}),": Understanding of nodes and topics\n",(0,r.jsx)(n.strong,{children:"Estimated Time"}),": 60-75 minutes\n",(0,r.jsx)(n.strong,{children:"Learning Outcomes"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Understand service request-response pattern"}),"\n",(0,r.jsx)(n.li,{children:"Create service servers and clients"}),"\n",(0,r.jsx)(n.li,{children:"Understand action goal-feedback-result pattern"}),"\n",(0,r.jsx)(n.li,{children:"Create action servers and clients"}),"\n",(0,r.jsx)(n.li,{children:"Choose appropriate communication pattern for different tasks"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);