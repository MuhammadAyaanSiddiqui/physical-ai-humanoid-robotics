"use strict";(globalThis.webpackChunkphysical_ai_course=globalThis.webpackChunkphysical_ai_course||[]).push([[1446],{8020:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"module-3-isaac/ch9-navigation/obstacle-avoidance","title":"Obstacle Avoidance & Costmaps","description":"Overview","source":"@site/docs/module-3-isaac/ch9-navigation/obstacle-avoidance.md","sourceDirName":"module-3-isaac/ch9-navigation","slug":"/module-3-isaac/ch9-navigation/obstacle-avoidance","permalink":"/physical-ai-humanoid-robotics/docs/module-3-isaac/ch9-navigation/obstacle-avoidance","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/module-3-isaac/ch9-navigation/obstacle-avoidance.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Path Planning Algorithms","permalink":"/physical-ai-humanoid-robotics/docs/module-3-isaac/ch9-navigation/path-planning"},"next":{"title":"Behavior Trees for Navigation","permalink":"/physical-ai-humanoid-robotics/docs/module-3-isaac/ch9-navigation/behavior-trees"}}');var i=s(4848),r=s(8453);const t={},l="Obstacle Avoidance & Costmaps",o={},c=[{value:"Overview",id:"overview",level:2},{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Part 1: Costmap Architecture",id:"part-1-costmap-architecture",level:2},{value:"Layered Costmap Structure",id:"layered-costmap-structure",level:3},{value:"Part 2: Costmap Configuration",id:"part-2-costmap-configuration",level:2},{value:"Basic Setup",id:"basic-setup",level:3},{value:"Global vs. Local Costmap",id:"global-vs-local-costmap",level:3},{value:"Part 3: Sensor Integration",id:"part-3-sensor-integration",level:2},{value:"LiDAR Integration",id:"lidar-integration",level:3},{value:"Depth Camera Integration",id:"depth-camera-integration",level:3},{value:"Part 4: Inflation Parameters",id:"part-4-inflation-parameters",level:2},{value:"Inflation Radius",id:"inflation-radius",level:3},{value:"Cost Scaling",id:"cost-scaling",level:3},{value:"Part 5: Recovery Behaviors",id:"part-5-recovery-behaviors",level:2},{value:"Configuration",id:"configuration",level:3},{value:"Recovery Sequence",id:"recovery-sequence",level:3},{value:"Part 6: Dynamic Obstacles",id:"part-6-dynamic-obstacles",level:2},{value:"Handling Moving Objects",id:"handling-moving-objects",level:3},{value:"Part 7: Testing in Isaac Sim",id:"part-7-testing-in-isaac-sim",level:2},{value:"Scenario: Navigate Around Dynamic Obstacles",id:"scenario-navigate-around-dynamic-obstacles",level:3},{value:"Common Issues",id:"common-issues",level:3},{value:"Summary",id:"summary",level:2},{value:"Resources",id:"resources",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"obstacle-avoidance--costmaps",children:"Obstacle Avoidance & Costmaps"})}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Costmaps"})," represent the environment as a grid where each cell has a cost (0=free, 255=obstacle). Nav2 uses layered costmaps to combine static maps, sensor data, and inflation zones for safe obstacle avoidance. Recovery behaviors handle situations when the robot gets stuck."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"What You'll Learn"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Configure costmap layers (static, obstacle, inflation)"}),"\n",(0,i.jsx)(n.li,{children:"Integrate sensor data (LiDAR, depth cameras) into costmaps"}),"\n",(0,i.jsx)(n.li,{children:"Set up recovery behaviors for stuck situations"}),"\n",(0,i.jsx)(n.li,{children:"Tune inflation radius and cost scaling"}),"\n",(0,i.jsx)(n.li,{children:"Handle dynamic obstacles"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Prerequisites"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Path Planning (previous lesson)"}),"\n",(0,i.jsx)(n.li,{children:"Understanding of occupancy grids"}),"\n",(0,i.jsx)(n.li,{children:"Sensor integration (LiDAR, cameras)"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Estimated Time"}),": 2-3 hours"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Configure multi-layer costmaps"}),"\n",(0,i.jsx)(n.li,{children:"Integrate real-time sensor data"}),"\n",(0,i.jsx)(n.li,{children:"Set inflation parameters for safety margins"}),"\n",(0,i.jsx)(n.li,{children:"Implement recovery behaviors"}),"\n",(0,i.jsx)(n.li,{children:"Handle dynamic obstacles effectively"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"part-1-costmap-architecture",children:"Part 1: Costmap Architecture"}),"\n",(0,i.jsx)(n.h3,{id:"layered-costmap-structure",children:"Layered Costmap Structure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Final Costmap = Static Layer + Obstacle Layer + Inflation Layer\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Layers"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Static Layer"}),": From pre-built map (walls, fixed obstacles)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Obstacle Layer"}),": From sensors (LiDAR, cameras) - dynamic"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Inflation Layer"}),": Safety margin around obstacles"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Voxel Layer"})," (optional): 3D obstacles for elevated sensors"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"part-2-costmap-configuration",children:"Part 2: Costmap Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"basic-setup",children:"Basic Setup"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"local_costmap:\n  local_costmap:\n    ros__parameters:\n      update_frequency: 5.0\n      publish_frequency: 2.0\n      global_frame: odom\n      robot_base_frame: base_link\n      rolling_window: true\n      width: 3\n      height: 3\n      resolution: 0.05\n\n      plugins: ['static_layer', 'obstacle_layer', 'inflation_layer']\n\n      static_layer:\n        plugin: nav2_costmap_2d::StaticLayer\n        map_subscribe_transient_local: true\n\n      obstacle_layer:\n        plugin: nav2_costmap_2d::ObstacleLayer\n        enabled: true\n        observation_sources: scan\n        scan:\n          topic: /scan\n          max_obstacle_height: 2.0\n          clearing: true\n          marking: true\n          data_type: LaserScan\n\n      inflation_layer:\n        plugin: nav2_costmap_2d::InflationLayer\n        inflation_radius: 0.55\n        cost_scaling_factor: 3.0\n"})}),"\n",(0,i.jsx)(n.h3,{id:"global-vs-local-costmap",children:"Global vs. Local Costmap"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Aspect"}),(0,i.jsx)(n.th,{children:"Global Costmap"}),(0,i.jsx)(n.th,{children:"Local Costmap"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Size"})}),(0,i.jsx)(n.td,{children:"Entire map"}),(0,i.jsx)(n.td,{children:"3x3m around robot"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Update Rate"})}),(0,i.jsx)(n.td,{children:"Slow (1 Hz)"}),(0,i.jsx)(n.td,{children:"Fast (5 Hz)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Use"})}),(0,i.jsx)(n.td,{children:"Global planning"}),(0,i.jsx)(n.td,{children:"Local planning"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Frame"})}),(0,i.jsx)(n.td,{children:"map"}),(0,i.jsx)(n.td,{children:"odom"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"part-3-sensor-integration",children:"Part 3: Sensor Integration"}),"\n",(0,i.jsx)(n.h3,{id:"lidar-integration",children:"LiDAR Integration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"observation_sources: scan\nscan:\n  topic: /scan\n  sensor_frame: laser_frame\n  observation_persistence: 0.0\n  expected_update_rate: 0.0\n  data_type: LaserScan\n  min_obstacle_height: 0.0\n  max_obstacle_height: 2.0\n  obstacle_max_range: 2.5\n  obstacle_min_range: 0.0\n  raytrace_max_range: 3.0\n  raytrace_min_range: 0.0\n  clearing: true\n  marking: true\n"})}),"\n",(0,i.jsx)(n.h3,{id:"depth-camera-integration",children:"Depth Camera Integration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"observation_sources: scan depth_camera\ndepth_camera:\n  topic: /camera/depth/points\n  sensor_frame: camera_depth_frame\n  data_type: PointCloud2\n  min_obstacle_height: 0.1\n  max_obstacle_height: 1.5\n  obstacle_max_range: 2.0\n  clearing: true\n  marking: true\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"part-4-inflation-parameters",children:"Part 4: Inflation Parameters"}),"\n",(0,i.jsx)(n.h3,{id:"inflation-radius",children:"Inflation Radius"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose"}),": Create safety margin around obstacles"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"inflation_layer:\n  inflation_radius: 0.55  # meters\n  cost_scaling_factor: 3.0\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Effect"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"inflation_radius: 0.3"})," \u2192 Tight navigation, risk of collision"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"inflation_radius: 0.8"})," \u2192 Conservative, wider berth around obstacles"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"cost-scaling",children:"Cost Scaling"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Formula"}),": ",(0,i.jsx)(n.code,{children:"cost = 253 * exp(-cost_scaling_factor * distance)"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"cost_scaling_factor: 1.0  # Gradual cost increase\ncost_scaling_factor: 10.0  # Sharp cost increase (more conservative)\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"part-5-recovery-behaviors",children:"Part 5: Recovery Behaviors"}),"\n",(0,i.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"recoveries_server:\n  ros__parameters:\n    recovery_plugins: ['spin', 'backup', 'wait']\n\n    spin:\n      plugin: nav2_recoveries::Spin\n      max_rotational_vel: 1.0\n      min_rotational_vel: 0.4\n      rotational_acc_lim: 3.2\n\n    backup:\n      plugin: nav2_recoveries::BackUp\n      backup_dist: 0.3\n      backup_speed: 0.05\n\n    wait:\n      plugin: nav2_recoveries::Wait\n      wait_duration: 5\n"})}),"\n",(0,i.jsx)(n.h3,{id:"recovery-sequence",children:"Recovery Sequence"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Clear costmap"})," (remove sensor artifacts)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Spin in place"})," (360\xb0 rotation to find opening)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Backup"})," (reverse 30cm)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Wait"})," (5 seconds for dynamic obstacles to move)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Abort"})," (if all recovery attempts fail)"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"part-6-dynamic-obstacles",children:"Part 6: Dynamic Obstacles"}),"\n",(0,i.jsx)(n.h3,{id:"handling-moving-objects",children:"Handling Moving Objects"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Temporal Marking"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"obstacle_layer:\n  observation_persistence: 1.0  # Keep obstacles for 1 second\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Clearing vs. Marking"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Marking"}),": Add obstacle to costmap (when sensor detects something)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Clearing"}),": Remove obstacle (when sensor reports free space)"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"scan:\n  clearing: true  # Clear obstacles not seen\n  marking: true   # Mark detected obstacles\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"part-7-testing-in-isaac-sim",children:"Part 7: Testing in Isaac Sim"}),"\n",(0,i.jsx)(n.h3,{id:"scenario-navigate-around-dynamic-obstacles",children:"Scenario: Navigate Around Dynamic Obstacles"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Load warehouse scene with moving objects"}),"\n",(0,i.jsx)(n.li,{children:"Launch Nav2 with costmap configuration"}),"\n",(0,i.jsx)(n.li,{children:"Send navigation goal"}),"\n",(0,i.jsx)(n.li,{children:"Observe robot avoiding obstacles in real-time"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Visualization in RViz"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Add ",(0,i.jsx)(n.strong,{children:"Costmap"})," \u2192 ",(0,i.jsx)(n.code,{children:"/local_costmap/costmap"})]}),"\n",(0,i.jsx)(n.li,{children:"Colors: Blue=free, Red=obstacle, Yellow=inflated"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Issue"}),": Robot stops unexpectedly\n",(0,i.jsx)(n.strong,{children:"Cause"}),": Phantom obstacles in costmap\n",(0,i.jsx)(n.strong,{children:"Solution"}),": Lower ",(0,i.jsx)(n.code,{children:"observation_persistence"}),", enable clearing"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Issue"}),": Robot collides with obstacles\n",(0,i.jsx)(n.strong,{children:"Cause"}),": Inflation radius too small\n",(0,i.jsx)(n.strong,{children:"Solution"}),": Increase ",(0,i.jsx)(n.code,{children:"inflation_radius"})," to 0.7-0.8m"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"\u2705 Configured layered costmaps (static, obstacle, inflation)\n\u2705 Integrated LiDAR and depth cameras\n\u2705 Tuned inflation for safety margins\n\u2705 Implemented recovery behaviors\n\u2705 Handled dynamic obstacles"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Next"}),": Behavior trees for navigation logic."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Nav2 Costmaps"}),": ",(0,i.jsx)(n.a,{href:"https://navigation.ros.org/configuration/packages/configuring-costmaps.html",children:"https://navigation.ros.org/configuration/packages/configuring-costmaps.html"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Recovery Behaviors"}),": ",(0,i.jsx)(n.a,{href:"https://navigation.ros.org/plugins/index.html#recovery",children:"https://navigation.ros.org/plugins/index.html#recovery"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var a=s(6540);const i={},r=a.createContext(i);function t(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);